{% schema %}
{
  "name": "Product Details",
  "target": "section",
  "settings": [
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent Color",
      "default": "#cc1417"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "options": [
        {
          "value": "grid",
          "label": "Side by side"
        },
        {
          "value": "stacked",
          "label": "Stacked"
        }
      ],
      "default": "grid"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_security_rating",
      "label": "Show security rating",
      "default": true
    },
    {
      "type": "select",
      "id": "image_size",
      "label": "Image size",
      "options": [
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ],
      "default": "medium"
    }
  ]
}
{% endschema %}

<style>
.product {
  display: {% if settings.layout == 'grid' %}grid{% else %}flex{% endif %};
  {% if settings.layout == 'grid' %}
  grid-template-columns: repeat(2, 1fr);
  {% else %}
  flex-direction: column;
  {% endif %}
  gap: 2rem;
  padding: 2rem;
}

.product__media {
  position: relative;
  {% if settings.layout == 'stacked' %}
  max-width: 800px;
  margin: 0 auto;
  {% endif %}
}

.product__image {
  width: 100%;
  height: auto;
  aspect-ratio: 1;
  object-fit: contain;
  {% if settings.image_size == 'small' %}
  max-width: 400px;
  {% elsif settings.image_size == 'medium' %}
  max-width: 600px;
  {% else %}
  max-width: 800px;
  {% endif %}
  margin: 0 auto;
}

.product__info {
  padding: 1rem;
}

.product__title {
  font-size: 1.5rem;
  font-weight: 600;
  margin-bottom: 1rem;
  color: #333;
}

.product__vendor {
  font-size: 0.9rem;
  color: #666;
  margin-bottom: 1rem;
}

.product__description {
  color: #444;
  margin: 1.5rem 0;
  line-height: 1.6;
}

.product__price {
  font-size: 1.25rem;
  font-weight: 600;
  color: {{ settings.accent_color }};
  margin: 1rem 0;
}

.product__variant-select {
  margin: 1rem 0;
  width: 100%;
  padding: 0.5rem;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.product__quantity {
  margin: 1rem 0;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.quantity__input {
  width: 80px;
  padding: 0.5rem;
  border: 1px solid #ddd;
  border-radius: 4px;
  text-align: center;
}

.product__submit {
  width: 100%;
  padding: 1rem;
  background: {{ settings.accent_color }};
  color: white;
  border: none;
  border-radius: 4px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.2s;
}

.product__submit:hover {
  background: {{ settings.accent_color | color_modify: 'lightness', -10 }};
}

.login-prompt {
  width: 100%;
  padding: 1rem;
  background: #f5f5f5;
  color: #666;
  text-align: center;
  border-radius: 4px;
  margin: 1rem 0;
  text-decoration: none;
  display: block;
}

.login-prompt:hover {
  background: #ebebeb;
}

.security-rating {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  margin: 1rem 0;
}

.rating-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: {{ settings.accent_color }};
}

.rating-dot.empty {
  background: #e5e5e5;
}

@media screen and (max-width: 768px) {
  .product {
    grid-template-columns: 1fr;
  }
}
</style>

<div class="product">
  <div class="product__media">
    <img 
      src="{{ product.featured_image | image_url: width: 800 }}"
      alt="{{ product.title }}"
      class="product__image"
      width="800"
      height="800"
      loading="lazy"
    >
  </div>

  <div class="product__info">
    <h1 class="product__title">{{ product.title }}</h1>
    
    {% if settings.show_vendor and product.vendor %}
      <div class="product__vendor">{{ product.vendor }}</div>
    {% endif %}

    {% if settings.show_security_rating %}
      <div class="security-rating">
        {% assign security_level = product.metafields.custom.security_level | default: 3 %}
        {% for i in (1..5) %}
          <span class="rating-dot {% if i > security_level %}empty{% endif %}"></span>
        {% endfor %}
        <span style="margin-left: 0.5rem; color: #666; font-size: 0.9rem;">
          Security Level {{ security_level }}/5
        </span>
      </div>
    {% endif %}

    <div class="product__description">
      {{ product.description }}
    </div>

    {% form 'product', product %}
      <select name="id" class="product__variant-select">
        {% for variant in product.variants %}
          <option
            value="{{ variant.id }}"
            {% if variant == product.selected_or_first_available_variant %}
              selected="selected"
            {% endif %}
          >
            {{ variant.title }}
          </option>
        {% endfor %}
      </select>

      <div class="product__quantity">
        <label for="Quantity">Quantity</label>
        <input
          type="number"
          name="quantity"
          id="Quantity"
          value="1"
          min="1"
          class="quantity__input"
        >
      </div>

      {% if customer %}
        <div class="product__price">
          {{ product.price | money }}
        </div>
        <button type="submit" class="product__submit">
          Add to cart
        </button>
      {% else %}
        <a href="{{ routes.account_login_url }}" class="login-prompt">
          Log in to see price and purchase
        </a>
      {% endif %}
    {% endform %}
  </div>
</div> 